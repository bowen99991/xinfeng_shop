"use strict";(self["webpackChunkxinfeng_shop"]=self["webpackChunkxinfeng_shop"]||[]).push([[873],{5518:function(t,e,a){a.r(e),a.d(e,{default:function(){return x}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-box"},[e("my-nav-bar",{attrs:{title:t.isLogin?"登录":"账号注册"}}),e("img",{directives:[{name:"show",rawName:"v-show",value:!!t.isLogin,expression:"isLogin ? true : false"}],staticClass:"logo",attrs:{src:t.logo,alt:""}}),e("img",{directives:[{name:"show",rawName:"v-show",value:!t.isLogin,expression:"isLogin ? false : true"}],staticClass:"logo",attrs:{src:a(8440),alt:""}}),e("van-form",{ref:"formRef",attrs:{"validate-first":""},on:{submit:t.submit}},[e("van-field",{attrs:{name:"loginName",placeholder:"请输入用户名",label:"用户名",colon:"",rules:[{pattern:/^(?:(?:\+|00)86)?1\d{10}$/,message:"请输入正确的用户名或手机号!"}]},model:{value:t.ruleForm.loginName,callback:function(e){t.$set(t.ruleForm,"loginName","string"===typeof e?e.trim():e)},expression:"ruleForm.loginName"}}),e("van-field",{attrs:{name:"password",placeholder:"请输入密码",label:"密码",colon:"",rules:[{required:!0,message:"密码是必填项!"}]},model:{value:t.ruleForm.password,callback:function(e){t.$set(t.ruleForm,"password","string"===typeof e?e.trim():e)},expression:"ruleForm.password"}}),e("van-field",{attrs:{name:"captcha",label:"验证码",placeholder:"请输入验证码",rules:[{required:!0,validator:t.validatorCaptcha,message:"验证码错误!"}],colon:""},scopedSlots:t._u([{key:"button",fn:function(){return[e("CaptchaImg",{ref:"captchaImg",model:{value:t.standardCaptcha,callback:function(e){t.standardCaptcha=e},expression:"standardCaptcha"}})]},proxy:!0}]),model:{value:t.ruleForm.captcha,callback:function(e){t.$set(t.ruleForm,"captcha","string"===typeof e?e.trim():e)},expression:"ruleForm.captcha"}}),e("a",{staticClass:"text",attrs:{href:"javascript:;"},on:{click:t.changeLogin}},[t._v(" "+t._s(t.isLogin?"还没账号,请点此注册":"已有账号,请点此登录")+" ")]),e("div",{staticStyle:{margin:"46px 26px"}},[e("van-button",{attrs:{round:"",block:"",type:"info","native-type":"submit"}},[t._v(t._s(t.isLogin?"登录":"点击注册"))])],1)],1)],1)},i=[],r=(a(560),a.p+"img/newbee-mall-vue3-app-logo.0d031e18.png"),o=a(6280),l=function(){var t=this,e=t._self._c;return e("div",{ref:"captchaBox",staticClass:"captcha-box"},[e("canvas",{ref:"canvasBox",attrs:{width:t.width,height:t.height},on:{click:t.createCaptcha}})])},n=[];const h=(t,e)=>Math.round(Math.random()*(e-t)+t),c=(t=4)=>{const e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";let a="",s=0;while(s<t){let t=h(0,61),i=e[t];a.includes(i)||(a+=i,s++)}return a},p=(t,e)=>{const a=h(t,e),s=h(t,e),i=h(t,e);return`rgb(${a},${s},${i})`};var d={name:"CaptchaImg",inheritAttrs:!1,data(){return{width:120,height:40}},methods:{createCaptcha(){let t=this.$refs.canvasBox,e=t.getContext("2d"),a=c();e.fillStyle=p(180,230),e.fillRect(0,0,t.width,t.height),[].forEach.call(a,((a,s)=>{const i=h(18,36),r=h(-30,30),o=t.width/8,l=t.height/(40/15);e.font=`bold ${i}px sans-serif`,e.textBaseline="top",e.fillStyle=p(80,150),e.save(),e.translate(2*o*s+o,l),e.rotate(r*Math.PI/180),e.fillText(a,5-o,-l),e.restore()}));for(let s=0;s<5;s++)e.beginPath(),e.moveTo(h(0,t.width),h(0,t.height)),e.lineTo(h(0,t.width),h(0,t.height)),e.strokeStyle=p(180,230),e.closePath(),e.stroke();for(let s=0;s<40;s++)e.beginPath(),e.arc(h(0,t.width),h(0,t.height),1,0,2*Math.PI),e.closePath(),e.fillStyle=p(150,200),e.fill();this.$listeners.input&&this.$emit("input",a)}},mounted(){this.reset=()=>{let t=this.$refs.captchaBox,e=getComputedStyle(t);this.width=Math.floor(parseFloat(e.width)),this.height=Math.floor(parseFloat(e.height)),this.$nextTick((()=>{this.createCaptcha()}))},this.reset(),window.addEventListener("resize",this.reset)},destroyed(){this.reset&&window.removeEventListener("resize",this.reset)}},u=d,g=a(1001),m=(0,g.Z)(u,l,n,!1,null,"0fd893c0",null),f=m.exports,v={name:"Login",props:[],data(){return{logo:r,isLogin:!0,standardCaptcha:"",ruleForm:{loginName:"17671238450",password:"123456",captcha:""}}},components:{CaptchaImg:f},computed:{},methods:{clear(){this.ruleForm.loginName="",this.ruleForm.password="",this.ruleForm.captcha="",this.$refs["formRef"].resetValidation(),this.$refs["captchaImg"].createCaptcha()},changeLogin(){this.isLogin=!this.isLogin,this.clear()},validatorCaptcha(t){let e=t.toLowerCase()===this.standardCaptcha.toLowerCase();return e||this.$refs["captchaImg"].createCaptcha(),e},async submit(){let{loginName:t,password:e}=this.ruleForm,a=this.isLogin?this.$API.userLogin:this.$API.userRegister;try{let{resultCode:s,data:i}=await a(t,e);200===+s?this.isLogin?(o.Z.storage.set("TK",i),await this.$store.dispatch("setProfileAsync"),this.$toast.success("登陆成功"),this.$router.push("/home")):(this.$toast.success("注册成功,请重新登陆"),this.changeLogin()):(this.clear(),this.$toast.fail((isLogin?"登录":"注册")+"失败, 请稍后再试!"))}catch(s){}}}},w=v,C=(0,g.Z)(w,s,i,!1,null,"53cf3084",null),x=C.exports},8440:function(t,e,a){t.exports=a.p+"img/defaultpic.67da185d.png"}}]);